<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ancient Fairy Dragon Archetype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/card-loader.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c141c; /* Deep, mystical blue-black */
            color: #e0e7ff; /* Light, airy lavender-white */
        }
        .container {
            max-width: 1024px;
        }
        .card {
            background-color: rgba(17, 24, 39, 0.8); /* Dark blue-gray with transparency */
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            border: 1px solid #3b82f6; /* Bright blue border */
            backdrop-filter: blur(10px);
        }
        .combo-step-card, .pro-con-card {
            background-color: rgba(30, 41, 59, 0.7);
            border: 1px solid #60a5fa;
        }
        .card-image-container {
            width: 100%;
            max-width: 180px;
            flex-shrink: 0;
            cursor: pointer;
        }
        .card-image {
            width: 100%;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        .card-placeholder {
            background-color: #1e293b;
            color: #93c5fd;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 0.75rem;
            line-height: 1rem;
            font-weight: bold;
            height: 100%;
            min-height: 250px;
            border-radius: 0.5rem;
            padding: 0.5rem;
            box-shadow: 0 0 10px #1e293b;
            border: 1px dashed #3b82f6;
        }
        .pro-icon { color: #34d399; }
        .con-icon { color: #ef4444; }
        .neutral-icon { color: #60a5fa; }
        .text-accent { color: #93c5fd; } /* A soft, glowing blue */
        .arrow-color { color: #93c5fd; }
        .heading-underline {
            border-bottom: 2px solid #93c5fd;
            display: inline-block;
            padding-bottom: 0.25rem;
        }
        .lore-link {
            color: #93c5fd;
            font-weight: bold;
            text-decoration: none;
            border-bottom: 1px dotted #93c5fd;
            transition: color 0.3s, text-shadow 0.3s;
        }
        .lore-link:hover {
            color: #fff;
            text-shadow: 0 0 8px #93c5fd;
        }
        .banner-header {
            position: relative;
            min-height: 160px;
            background-color: #0c141c;
            border-radius: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            margin-bottom: 2.5rem;
            border: 1px solid #3b82f6;
        }

        #starfield-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .banner-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at center, rgba(12, 20, 28, 0.4) 0%, rgba(12, 20, 28, 0.9) 100%);
            z-index: 2;
        }

        .banner-header h1, .banner-header p {
            position: relative;
            z-index: 3;
            text-shadow: 0 0 15px rgba(147, 197, 253, 0.7);
        }
        
        .banner-header h1 {
             font-family: 'Cinzel', serif;
        }

        .ygo-home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
            color: white;
            border: 2px solid #6366f1;
            border-radius: 12px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4), 0 0 20px rgba(99, 102, 241, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            overflow: hidden;
        }
        
        .ygo-home-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.6), 0 0 30px rgba(99, 102, 241, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: #8b5cf6;
        }
        
        .ygo-home-button i {
            font-size: 22px;
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.8);
        }

        /* Card Popup Styles */
        #card-popup {
            position: fixed;
            display: none;
            opacity: 0;
            padding: 1rem;
            background-color: rgba(12, 20, 28, 0.95);
            border: 1px solid #3b82f6;
            border-radius: 0.75rem;
            color: #e0e7ff;
            max-width: 300px;
            z-index: 1000;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            font-size: 0.875rem;
        }
        #card-popup h3 {
            font-family: 'Cinzel', serif;
            color: #60a5fa;
            font-weight: bold;
            font-size: 1.125rem;
        }
        #card-popup p {
            margin-top: 0.5rem;
        }
        #card-popup-stats {
            font-family: 'Cinzel', serif;
            color: #60a5fa;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <!-- Card Popup -->
    <div id="card-popup"></div>
    <a href="index-refactored.html" class="ygo-home-button" title="Return to Archetype Nexus">
        <i class="fas fa-home"></i>
    </a>
    <div class="container mx-auto">
        <header class="banner-header text-center">
            <canvas id="starfield-canvas"></canvas>
            <h1 class="text-3xl md:text-5xl font-extrabold text-white mb-2">Ancient Fairy Dragon</h1>
            <p class="text-lg md:text-xl text-blue-200">Deconstruction of a Legend: Archetype & Engine</p>
        </header>

        <section class="mb-10 md:mb-16 animate-fadeIn">
            <div class="card p-6">
                <h2 class="text-xl md:text-2xl font-bold text-white mb-4">Executive Summary</h2>
                <p class="text-indigo-200">
                    <strong class="text-accent font-bold">Ancient Fairy Dragon</strong> stands as a titan in Yu-Gi-Oh! history, a card whose power necessitated a ban and later, a thoughtful errata for its return. Today, it lives a dual life: as the heart of a dedicated, control-style archetype and as a generic, meta-defining engine. This analysis explores both identities, from the pure strategy's unique mechanics to its more famous role as a universal key that unlocks the most powerful Field Spells in the game for a variety of top-tier decks.
                </p>
            </div>
        </section>

        <section class="mb-10 md:mb-16 animate-fadeIn" style="animation-delay: 0.2s;">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-8 text-center heading-underline">The Core Archetype: Cards of the Spirit World</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card p-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-seedling text-4xl text-green-300 mr-4"></i>
                        <h3 class="text-xl font-bold text-white">The Starters & Extenders</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Regulus the Fairy Beast</h4>
                            <p class="text-sm text-indigo-200">The one-card starter. Searches any archetype Spell/Trap on summon, setting up your entire board.</p>
                        </div>
                        <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Spore the Fairy Seed</h4>
                            <p class="text-sm text-indigo-200">A flexible Level 1 Plant Tuner that can modulate its level and revive itself from the GY to enable Synchro climbing.</p>
                        </div>
                    </div>
                </div>
                <div class="card p-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-landmark text-4xl text-blue-300 mr-4"></i>
                        <h3 class="text-xl font-bold text-white">The Field & Disruption</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">World of Spirits</h4>
                            <p class="text-sm text-indigo-200">The core Field Spell. Searches a monster, forces opponent's monsters to Defense Position, and destroys them in the End Phase.</p>
                        </div>
                        <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Eternal Sunshine</h4>
                            <p class="text-sm text-indigo-200">A Continuous Trap that provides repeatable negation and stat reduction, scaling with the number of "Ancient Fairy Dragon" monsters you control.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="mb-10 md:mb-16 animate-fadeIn" style="animation-delay: 0.4s;">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center heading-underline">The One-Card Combo: Regulus to Victory</h2>
            <div class="flex flex-col items-center gap-6">
                <div class="card p-6 combo-step-card w-full max-w-lg">
                    <div class="flex flex-col md:flex-row items-center md:items-start gap-4">
                        <div id="regulus-img-container" class="card-image-container flex-shrink-0 card-placeholder">Regulus the Fairy Beast</div>
                        <div>
                            <div class="flex items-center mb-2">
                                <span class="bg-[#1a1633] text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">1</span>
                                <h3 class="text-lg font-bold">Summon & Search</h3>
                            </div>
                            <p class="text-indigo-200">Normal Summon <strong class="text-accent">Regulus</strong>, search for <strong class="text-accent">World of Spirits</strong>. Activate World of Spirits to search for <strong class="text-accent">Spore the Fairy Seed</strong>.</p>
                        </div>
                    </div>
                </div>
                <div class="w-full flex justify-center"><i class="fas fa-arrow-down text-2xl arrow-color my-4"></i></div>
                <div class="card p-6 combo-step-card w-full max-w-lg">
                     <div class="flex flex-col md:flex-row items-center md:items-start gap-4">
                        <div id="afd-img-container" class="card-image-container flex-shrink-0 card-placeholder">Ancient Fairy Dragon</div>
                        <div>
                            <div class="flex items-center mb-2">
                                <span class="bg-[#1a1633] text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">2</span>
                                <h3 class="text-lg font-bold">Synchro Climb</h3>
                            </div>
                            <p class="text-indigo-200">Use Regulus to summon Spore. Tune them into the original <strong class="text-accent">Ancient Fairy Dragon</strong>. Revive Spore from the GY.</p>
                        </div>
                    </div>
                </div>
                <div class="w-full flex justify-center"><i class="fas fa-arrow-down text-2xl arrow-color my-4"></i></div>
                <div class="card p-6 combo-step-card w-full max-w-lg">
                     <div class="flex flex-col md:flex-row items-center md:items-start gap-4">
                        <div id="afld-img-container-combo" class="card-image-container flex-shrink-0 card-placeholder">Ancient Fairy Life Dragon</div>
                        <div>
                            <div class="flex items-center mb-2">
                                <span class="bg-[#1a1633] text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">3</span>
                                <h3 class="text-lg font-bold">The Final Boss</h3>
                            </div>
                            <p class="text-indigo-200">Tune Ancient Fairy Dragon and Spore into <strong class="text-accent">Ancient Fairy Life Dragon</strong>. Use its effect to search for <strong class="text-accent">Eternal Sunshine</strong>, then Set it.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-10 md:mb-16 animate-fadeIn" style="animation-delay: 0.6s;">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center heading-underline">The Endboard: A Fortress of Spirits</h2>
            <div class="card p-6">
                <p class="text-indigo-200 mb-4">The goal of the pure strategy is to establish a lockdown board that controls the opponent's ability to play monsters while setting up your own unique win condition.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                    <div>
                        <h4 class="text-lg font-bold text-accent mb-2">Layers of Disruption:</h4>
                        <ul class="list-disc list-inside space-y-2 text-indigo-100">
                            <li><strong>Summon Response:</strong> <strong class="text-accent">World of Spirits</strong> forces any monster Special Summoned in Attack Position into Defense Position.</li>
                            <li><strong>Targeted Negation:</strong> <strong class="text-accent">Eternal Sunshine</strong> provides a repeatable Quick-Effect to negate a monster's effects and halve its stats.</li>
                            <li><strong>End Phase Wipe:</strong> At the end of the opponent's turn, <strong class="text-accent">World of Spirits</strong> destroys all of their Attack Position monsters.</li>
                            <li><strong>Battle Superiority:</strong> On your turn, <strong class="text-accent">Ancient Fairy Life Dragon</strong> attacks using its massive 3300 DEF, boosted further by Eternal Sunshine.</li>
                        </ul>
                    </div>
                    <div class="flex justify-center items-center">
                         <div id="afld-img-container" class="card-image-container card-placeholder">Ancient Fairy Life Dragon</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-10 md:mb-16 animate-fadeIn" style="animation-delay: 0.8s;">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center heading-underline">The Generic Engine: A Universal Key</h2>
            <div class="card p-6">
                <p class="text-indigo-200 mb-4">In competitive play, Ancient Fairy Dragon is rarely seen with its own archetype. Instead, it's a powerful tool used by other decks to search their game-winning Field Spells. The P.U.N.K. engine is the most common way to summon it.</p>
                 <p class="text-indigo-200">The errata now restricts Ancient Fairy Dragon to a hard once-per-turn on both effects, preventing the loops that got it banned. This change, however, opened the door for its use in a more controlled, strategic manner. A particularly potent interaction involves its synergy with <a href="https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=14969&request_locale=en" class="lore-link" target="_blank">quick-play spells</a> and other effects that can be chained during an opponent's turn, allowing for unexpected searches and plays that can catch an opponent off-guard.</p>
            </div>
        </section>
        
        <section class="animate-fadeIn" style="animation-delay: 1s;">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center heading-underline">Competitive Analysis</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="card p-6 pro-con-card">
                    <h3 class="text-xl font-bold text-green-400 mb-4">Strengths</h3>
                    <ul class="list-disc list-inside space-y-2 text-indigo-200">
                        <li><span class="pro-icon"><i class="fas fa-key"></i></span> <strong class="text-green-300">Universal Searcher:</strong> As an engine, it provides unparalleled access to any Field Spell.</li>
                        <li><span class="pro-icon"><i class="fas fa-cogs"></i></span> <strong class="text-green-300">High Consistency (Pure):</strong> The pure build has a reliable one-card combo.</li>
                        <li><span class="pro-icon"><i class="fas fa-chess-rook"></i></span> <strong class="text-green-300">Unique Control:</strong> The pure deck's lockdown can be difficult for unprepared opponents to break.</li>
                    </ul>
                </div>
                <div class="card p-6 pro-con-card">
                    <h3 class="text-xl font-bold text-red-400 mb-4">Weaknesses</h3>
                    <ul class="list-disc list-inside space-y-2 text-indigo-200">
                        <li><span class="con-icon"><i class="fas fa-hand-paper"></i></span> <strong class="text-red-300">Centralized Choke Point:</strong> The pure deck is extremely vulnerable to negation on its starter, Regulus.</li>
                        <li><span class="con-icon"><i class="fas fa-wind"></i></span> <strong class="text-red-300">Fragile Board (Pure):</strong> The control setup is easily dismantled by Spell/Trap removal.</li>
                        <li><span class="con-icon"><i class="fas fa-exclamation-triangle"></i></span> <strong class="text-red-300">Internal Conflict:</strong> The best effect of the original AFD clashes with the pure deck's main strategy.</li>
                    </ul>
                </div>
                <div class="card p-6 pro-con-card">
                    <h3 class="text-xl font-bold text-white mb-4">Key Engines & Synergies</h3>
                    <ul class="list-disc list-inside space-y-2 text-indigo-200">
                        <li><span class="neutral-icon"><i class="fas fa-music"></i></span> <strong class="text-accent">P.U.N.K. Engine:</strong> The most efficient way to summon AFD and search any Field Spell.</li>
                        <li><span class="neutral-icon"><i class="fas fa-atom"></i></span> <strong class="text-accent">Tearlaments / ABC:</strong> Prime examples of decks that abuse AFD's searching power for their own Field Spells.</li>
                        <li><span class="neutral-icon"><i class="fas fa-book-dead"></i></span> <strong class="text-accent">Floodgate Access:</strong> Can search powerful floodgates like Necrovalley or Secret Village of the Spellcasters.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="mb-10 md:mb-16">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center">TCG Banlist Status</h2>
            <div class="card p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="card combo-step-card p-4">
                        <h4 class="text-lg font-bold text-green-400 mb-2">Unrestricted Cards</h4>
                        <ul id="unrestricted-list" class="list-disc list-inside space-y-1 text-sm text-gray-300">
                            <!-- JS will populate this -->
                        </ul>
                    </div>
                    <div class="card combo-step-card p-4">
                        <h4 class="text-lg font-bold text-yellow-400 mb-2">Limited & Semi-Limited Cards</h4>
                         <ul id="limited-list" class="list-disc list-inside space-y-1 text-sm text-gray-300">
                            <!-- JS will populate this -->
                        </ul>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-blue-900 bg-opacity-30 rounded border-l-4 border-blue-500">
                    <p id="banlist-implications" class="text-sm text-gray-300"><!-- JS will populate this --></p>
                </div>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const canvas = document.getElementById('starfield-canvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                let stars = [];
                const numStars = 200;

                const setCanvasSize = () => {
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                };

                class Star {
                    constructor() {
                        this.x = Math.random() * canvas.width;
                        this.y = Math.random() * canvas.height;
                        this.z = Math.random() * canvas.width;
                        this.pz = this.z;
                    }
                    update() {
                        this.z -= 2;
                        if (this.z < 1) {
                            this.z = canvas.width;
                            this.x = Math.random() * canvas.width;
                            this.y = Math.random() * canvas.height;
                            this.pz = this.z;
                        }
                    }
                    draw() {
                        const sx = (this.x - canvas.width / 2) * (canvas.width / this.z) + canvas.width / 2;
                        const sy = (this.y - canvas.height / 2) * (canvas.width / this.z) + canvas.height / 2;
                        const r = Math.max(0.1, (1 - this.z / canvas.width) * 2.5);
                        
                        ctx.beginPath();
                        ctx.arc(sx, sy, r, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(147, 197, 253, ${1 - this.z / canvas.width})`;
                        ctx.fill();
                    }
                }

                function initStars() {
                    stars = [];
                    for(let i = 0; i < numStars; i++) {
                        stars.push(new Star());
                    }
                }

                function animate() {
                    ctx.fillStyle = '#0c141c';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    stars.forEach(star => {
                        star.update();
                        star.draw();
                    });
                    
                    requestAnimationFrame(animate);
                }
                
                setCanvasSize();
                initStars();
                animate();

                window.addEventListener('resize', () => {
                    setCanvasSize();
                    initStars();
                });
            }

            // --- CARD POPUP AND IMAGE FETCHER SCRIPT ---

            const cardDataCache = {};
            const popup = document.getElementById('card-popup');
            let activePopup = null;

            async function fetchAndProcessCardData(cardName, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.addEventListener('click', (event) => {
                    event.stopPropagation();
                    showPopup(event, cardName);
                });

                const apiUrl = `https://db.ygoprodeck.com/api/v7/cardinfo.php?name=${encodeURIComponent(cardName)}`;

                try {
                    if (cardDataCache[cardName]) {
                        displayCardImage(cardDataCache[cardName], container);
                        return;
                    }
                    
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const data = await response.json();
                    const cardInfo = data?.data?.[0];
                    
                    if (cardInfo) {
                        cardDataCache[cardName] = cardInfo;
                        displayCardImage(cardInfo, container);
                    } else {
                        throw new Error("Card data not found in API response.");
                    }
                } catch (error) {
                    console.error(`Failed to fetch data for "${cardName}":`, error);
                    container.innerHTML = `<div class="card-placeholder animate-fadeIn">${cardName}</div>`;
                }
            }

            function displayCardImage(cardInfo, container) {
                 const imageUrl = cardInfo.card_images?.[0]?.image_url;
                 if (imageUrl) {
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.alt = cardInfo.name;
                    img.className = 'w-full h-auto rounded-lg shadow-md animate-fadeIn';
                    container.innerHTML = '';
                    container.appendChild(img);
                } else {
                     container.innerHTML = `<div class="card-placeholder animate-fadeIn">${cardInfo.name}</div>`;
                }
            }
            
            function showPopup(event, cardName) {
                if (!popup) return;
                const cardInfo = cardDataCache[cardName];
                if (!cardInfo) return;

                let stats = '';
                let atkDef = [];
                if (cardInfo.atk !== undefined) atkDef.push(`ATK/${cardInfo.atk}`);
                if (cardInfo.def !== undefined) atkDef.push(`DEF/${cardInfo.def}`);
                if (cardInfo.linkval) atkDef.push(`LINK-${cardInfo.linkval}`);
                if(atkDef.length > 0) {
                    stats = `<p id="card-popup-stats" class="mt-2">${atkDef.join(' ')}</p>`;
                }
                
                const cardType = cardInfo.type.includes('Monster') ? `[${cardInfo.race} / ${cardInfo.type.replace(' Monster', '')}]` : `[${cardInfo.race} Card]`;

                popup.innerHTML = `
                    <div>
                        <h3>${cardInfo.name}</h3>
                        <p class="text-xs text-blue-300">${cardType}</p>
                        <div class="w-full h-px bg-blue-600 my-2"></div>
                        <p class="text-xs">${cardInfo.desc.replace(/\r\n/g, '<br>')}</p>
                        ${stats}
                    </div>
                `;
                
                movePopup(event);
                popup.style.display = 'block';
                setTimeout(() => { popup.style.opacity = 1; }, 10);
                activePopup = popup;
            }

            function hidePopup() {
                if (activePopup) {
                    activePopup.style.opacity = 0;
                    setTimeout(() => { 
                        if (activePopup) activePopup.style.display = 'none'; 
                    }, 200);
                    activePopup = null;
                }
            }

            function movePopup(event) {
                if (!popup) return;
                const popupWidth = popup.offsetWidth;
                const popupHeight = popup.offsetHeight;
                const cushion = 20;

                let x = event.clientX + cushion;
                let y = event.clientY + cushion;

                if (x + popupWidth > window.innerWidth) {
                    x = event.clientX - popupWidth - cushion;
                }
                if (y + popupHeight > window.innerHeight) {
                    y = event.clientY - popupHeight - cushion;
                }

                popup.style.left = `${x}px`;
                popup.style.top = `${y}px`;
            }

            // Global click listener to close the popup
            document.addEventListener('click', hidePopup);

            const cardsToLoad = {
                'regulus-img-container': 'Regulus the Fairy Beast',
                'afd-img-container': 'Ancient Fairy Dragon',
                'afld-img-container-combo': 'Ancient Fairy Life Dragon',
                'afld-img-container': 'Ancient Fairy Life Dragon',
            };

            for (const [containerId, cardName] of Object.entries(cardsToLoad)) {
                fetchAndProcessCardData(cardName, containerId);
            }
            
            // Banlist check
            const cardsToCheck = [
                "Ancient Fairy Dragon",
                "Regulus the Fairy Beast",
                "World of Spirits",
                "Spore the Fairy Seed",
                "Ancient Fairy Life Dragon",
                "Eternal Sunshine"
            ];

            const unrestrictedList = document.getElementById('unrestricted-list');
            const limitedList = document.getElementById('limited-list');
            const implicationsText = document.getElementById('banlist-implications');

            fetch('https://db.ygoprodeck.com/api/v7/cardinfo.php?banlist=tcg')
                .then(response => response.json())
                .then(banlistData => {
                    const banlist = banlistData.data;
                    let isAFDLimited = false;

                    cardsToCheck.forEach(cardName => {
                        const cardData = banlist.find(c => c.name === cardName);
                        const li = document.createElement('li');
                        
                        if (cardData && cardData.banlist_info && cardData.banlist_info.ban_tcg) {
                             if (cardData.banlist_info.ban_tcg === 'Limited' || cardData.banlist_info.ban_tcg === 'Semi-Limited') {
                                li.innerHTML = `<strong class="text-yellow-400">${cardName} (${cardData.banlist_info.ban_tcg})</strong>`;
                                limitedList.appendChild(li);
                                if (cardName === "Ancient Fairy Dragon") isAFDLimited = true;
                            } else { // Unrestricted or not on list
                               li.innerHTML = `<strong class="text-green-400">${cardName} (Unrestricted)</strong>`;
                               unrestrictedList.appendChild(li);
                            }
                        } else {
                             li.innerHTML = `<strong class="text-green-400">${cardName} (Unrestricted)</strong>`;
                             unrestrictedList.appendChild(li);
                        }
                    });

                    if (limitedList.children.length === 0) {
                        const li = document.createElement('li');
                        li.textContent = 'None';
                        limitedList.appendChild(li);
                    }

                    if(isAFDLimited) {
                        implicationsText.textContent = "With the errata'd Ancient Fairy Dragon at Limited status, both the pure strategy and engine variants are legal for play, though consistency is slightly impacted. The core archetype cards remain unrestricted, allowing the pure build to function as intended.";
                    } else {
                         implicationsText.textContent = "With Ancient Fairy Dragon and all its new support cards fully unrestricted, the archetype can be played at maximum consistency. This allows for both the pure control strategy and its more common role as a generic engine to be fully explored in the current meta.";
                    }
                })
                .catch(error => {
                    console.error('Error fetching banlist:', error);
                    implicationsText.textContent = 'Could not fetch banlist data. Please check manually.';
                });

        });
    </script>
</body>
</html>

