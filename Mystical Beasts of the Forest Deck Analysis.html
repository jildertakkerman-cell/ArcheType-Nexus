<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystical Beast of the Forest Archetype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/card-loader.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1a12; /* Deep Forest Green */
            color: #e6f2e9; /* Soft Off-white */
        }
        .container {
            max-width: 1024px;
        }
        .card {
            background-color: #1a2b20; /* Darker Moss Green */
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            border: 1px solid #2a4b35; /* Forest Green Border */
        }
        .combo-step-card {
            background-color: #203628;
            border: 1px solid #30523d;
        }
        .pro-con-card {
            background-color: #203628;
            border: 1px solid #30523d;
        }
        .card-image-container {
            width: 100%;
            max-width: 180px;
            flex-shrink: 0;
        }
        .card-image {
            width: 100%;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out;
        }
        .card-placeholder {
            background-color: #203628;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 0.75rem;
            line-height: 1rem;
            font-weight: bold;
            height: 100%;
            min-height: 250px; 
            border-radius: 0.5rem;
            padding: 0.5rem;
            box-shadow: 0 0 10px #203628;
            cursor: pointer;
        }
        .pro-icon { color: #34d399; }
        .con-icon { color: #ef4444; }
        .neutral-icon { color: #60a5fa; }
        .text-accent { color: #a7f3d0; } /* Mint Green */
        .arrow-color { color: #5eead4; } /* Teal */
        .heading-underline {
            border-bottom: 2px solid #5eead4;
            display: inline-block;
            padding-bottom: 0.25rem;
        }
        .lore-link {
            color: #a7f3d0;
            font-weight: bold;
            text-decoration: none;
            border-bottom: 1px dotted #a7f3d0;
            transition: color 0.3s;
        }
        .lore-link:hover {
            color: #fff;
        }

        /* --- NEW ANIMATED BANNER STYLES --- */
        .banner-header {
            position: relative;
            min-height: 160px;
            background-color: #0d1a12;
            border-radius: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            margin-bottom: 2.5rem;
        }

        #forest-banner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .banner-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle, rgba(13, 26, 18, 0.5) 0%, rgba(13, 26, 18, 0.9) 100%);
            z-index: 2;
        }

        .banner-header h1, .banner-header p {
            position: relative;
            z-index: 3;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        }

        @media (min-width: 768px) {
            .banner-header {
                margin-bottom: 4rem;
            }
        }
        /* --- END OF BANNER STYLES --- */
        /* --- Yu-Gi-Oh! Themed Home Button Styles --- */
        .ygo-home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
            color: white;
            border: 2px solid #6366f1;
            border-radius: 12px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 4px 15px rgba(99, 102, 241, 0.4),
                0 0 20px rgba(99, 102, 241, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            overflow: hidden;
        }
        
        .ygo-home-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 30%, rgba(99, 102, 241, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(139, 92, 246, 0.2) 0%, transparent 50%);
            animation: ygoButtonPulse 3s ease-in-out infinite;
            pointer-events: none;
        }
        
        .ygo-home-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 8px 25px rgba(99, 102, 241, 0.6),
                0 0 30px rgba(99, 102, 241, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: #8b5cf6;
        }
        
        .ygo-home-button:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .ygo-home-button i {
            font-size: 22px;
            position: relative;
            z-index: 2;
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.8);
            animation: ygoIconGlow 2s ease-in-out infinite alternate;
        }
        
        .ygo-home-button .ygo-home-text {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: 600;
            color: #a5b4fc;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
            pointer-events: none;
        }
        
        .ygo-home-button:hover .ygo-home-text {
            opacity: 1;
        }
        
        @keyframes ygoButtonPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        @keyframes ygoIconGlow {
            0% { 
                text-shadow: 
                    0 0 10px rgba(99, 102, 241, 0.8),
                    0 0 20px rgba(139, 92, 246, 0.4);
            }
            100% { 
                text-shadow: 
                    0 0 15px rgba(99, 102, 241, 1),
                    0 0 30px rgba(139, 92, 246, 0.6),
                    0 0 40px rgba(59, 130, 246, 0.3);
            }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .ygo-home-button {
                width: 50px;
                height: 50px;
                top: 15px;
                left: 15px;
            }
            
            .ygo-home-button i {
                font-size: 18px;
            }
        }
        #card-popup {
            position: fixed;
            background: rgba(32, 54, 40, 0.95);
            border: 2px solid #5eead4;
            border-radius: 0.5rem;
            padding: 1rem;
            max-width: 300px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }
        #card-popup.show {
            opacity: 1;
            pointer-events: auto;
        }
        #card-popup img {
            max-width: 100%;
            height: auto;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }
        #card-popup h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
            font-weight: bold;
            color: #5eead4;
        }
        #card-popup p {
            margin: 0.25rem 0;
            font-size: 0.9rem;
            line-height: 1.4;
            word-wrap: break-word;
        }
        #card-popup .type {
            color: #34d399;
            font-weight: bold;
        }
        #card-popup .stats {
            color: #ef4444;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <!-- Yu-Gi-Oh! Themed Home Button -->
    <a href="index-refactored.html" class="ygo-home-button" title="Return to Archetype Nexus">
        <i class="fas fa-home"></i>
        <span class="ygo-home-text">NEXUS</span>
    </a>
    <div class="container mx-auto">
        <!-- MODIFIED Title Section -->
        <header class="banner-header text-center">
            <canvas id="forest-banner"></canvas>
            <h1 class="text-3xl md:text-5xl font-extrabold text-white mb-2 heading-underline">Mystical Beast of the Forest</h1>
            <p class="text-lg md:text-xl text-green-200">A Deep Dive into the Forest's Synergies</p>
        </header>

        <!-- Executive Summary Section -->
        <section class="mb-10 md:mb-16">
            <div class="card p-6">
                <h2 class="text-xl md:text-2xl font-bold text-white mb-4">Executive Summary</h2>
                <p class="text-green-100">
                    The <strong class="text-accent font-bold">"Mystical Beast of the Forest"</strong> is not a conventional archetype but a synergistic package of EARTH Beast monsters. Lacking dedicated Spell/Trap support, its strength lies in its low-level engine focused on Graveyard interaction. This engine, when integrated into other robust strategies, provides potent disruption and resource looping. The key to mastering this archetype is understanding how these 
                    <a href="https://yugipedia.com/wiki/Mystical_Beast_of_the_Forest" target="_blank" class="lore-link">creatures of the wild forest</a>
                    work in concert with external support to create a formidable competitive force.
                </p>
            </div>
        </section>

        <!-- The Forest Dwellers Section -->
        <section class="mb-10 md:mb-16">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center">The Forest Dwellers: Core Monsters</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Core Engine -->
                <div class="card p-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-leaf text-4xl text-green-300 mr-4"></i>
                        <h3 class="text-xl font-bold text-white">The Core Engine</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Kittytail, Mystical Beast of the Forest</h4>
                            <p class="text-sm text-green-100">The Graveyard enabler. A conditional "Foolish Burial" that sets up your main disruptive threat, Kalantosa.</p>
                        </div>
                        <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Kalantosa, Mystical Beast of the Forest</h4>
                            <p class="text-sm text-green-100">The primary disruption tool. Its non-once-per-turn destruction effect is the lynchpin of the engine's competitive application.</p>
                        </div>
                        <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Valerifawn, Mystical Beast of the Forest</h4>
                            <p class="text-sm text-green-100">The central combo enabler. A Tuner and reanimator that discards to revive Kalantosa, triggering its effect.</p>
                        </div>
                    </div>
                </div>
                <!-- Support Monsters -->
                <div class="card p-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-paw text-4xl text-green-300 mr-4"></i>
                        <h3 class="text-xl font-bold text-white">Support & Utility</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Carpiponica, Mystical Beast of the Forest</h4>
                            <p class="text-sm text-green-100">The primary in-theme searcher and a conditional extender, adding consistency to the strategy.</p>
                        </div>
                         <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Uniflora, Mystical Beast of the Forest</h4>
                            <p class="text-sm text-green-100">A high-risk, high-reward reviver, limited by its restrictive activation condition but powerful in pure Beast builds.</p>
                        </div>
                         <div class="card combo-step-card p-4">
                            <h4 class="text-lg font-bold text-accent mb-1">Alpacaribou, Mystical Beast of the Forest</h4>
                            <p class="text-sm text-green-100">A situational boss monster providing protection, though it lacks synergy with the core Beast-type monsters.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Core Combo Section -->
        <section class="mb-10 md:mb-16">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center">Core Combo: The Kalantosa Trigger</h2>
            <p class="text-green-100 mb-8 text-center max-w-2xl mx-auto">This walkthrough demonstrates the central interaction of the engine: turning Graveyard setup into powerful disruption.</p>
            <div class="flex flex-col items-center gap-6">
                <!-- Step 1 -->
                <div class="card p-6 combo-step-card w-full max-w-lg">
                    <div class="flex flex-col md:flex-row items-center md:items-start gap-4">
                        <div id="kittytail-img-container" class="card-image-container flex-shrink-0 card-placeholder">Kittytail, Mystical Beast of the Forest</div>
                        <div>
                            <div class="flex items-center mb-2">
                                <span class="bg-[#1a2b20] text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">1</span>
                                <h3 class="text-lg font-bold">Load the Graveyard</h3>
                            </div>
                            <p class="text-green-100">Summon <strong class="text-accent font-bold">Kittytail</strong>. Use its effect to send <strong class="text-accent font-bold">Kalantosa</strong> from your Deck to the Graveyard.</p>
                        </div>
                    </div>
                </div>
                <!-- Arrow -->
                <div class="w-full flex justify-center">
                    <svg class="h-10 w-10 arrow-color animate-fadeIn" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                    </svg>
                </div>
                <!-- Step 2 -->
                <div class="card p-6 combo-step-card w-full max-w-lg">
                     <div class="flex flex-col md:flex-row items-center md:items-start gap-4">
                        <div id="valerifawn-img-container" class="card-image-container flex-shrink-0 card-placeholder">Valerifawn, Mystical Beast of the Forest</div>
                        <div>
                            <div class="flex items-center mb-2">
                                <span class="bg-[#1a2b20] text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">2</span>
                                <h3 class="text-lg font-bold">Activate the Revival</h3>
                            </div>
                            <p class="text-green-100">Use <strong class="text-accent font-bold">Valerifawn's</strong> effect. Discard a card to Special Summon <strong class="text-accent font-bold">Kalantosa</strong> from the Graveyard.</p>
                        </div>
                    </div>
                </div>
                <!-- Arrow -->
                <div class="w-full flex justify-center">
                    <svg class="h-10 w-10 arrow-color animate-fadeIn" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                    </svg>
                </div>
                <!-- Step 3 -->
                <div class="card p-6 combo-step-card w-full max-w-lg">
                     <div class="flex flex-col md:flex-row items-center md:items-start gap-4">
                        <div id="kalantosa-img-container-combo" class="card-image-container flex-shrink-0 card-placeholder">Kalantosa, Mystical Beast of the Forest</div>
                        <div>
                            <div class="flex items-center mb-2">
                                <span class="bg-[#1a2b20] text-white rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">3</span>
                                <h3 class="text-lg font-bold">Disrupt the Board</h3>
                            </div>
                            <p class="text-green-100">Because <strong class="text-accent font-bold">Kalantosa</strong> was summoned by a Beast's effect, its own effect triggers, allowing you to destroy any card on the field.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Endboard Section -->
        <section class="mb-10 md:mb-16">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center">Typical Endboard: Melffy Partnership</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mx-auto max-w-4xl">
                <!-- Melffy of the Forest -->
                <div class="card p-6 pro-con-card">
                    <h3 class="text-xl font-bold text-white mb-4 text-center">Melffy of the Forest</h3>
                    <div class="flex justify-center mb-4">
                        <div id="melffy-forest-img-container" class="card-image-container card-placeholder">Melffy of the Forest</div>
                    </div>
                    <ul class="list-disc list-inside space-y-2 text-green-100">
                        <li><strong class="text-accent font-bold">Negation:</strong> Can negate an opponent's face-up monster's effects and prevent it from attacking.</li>
                        <li><strong class="text-accent font-bold">Search Power:</strong> Searches for key Melffy monsters like Melffy Puppy to set up disruptions.</li>
                    </ul>
                </div>
                <!-- Melffy Puppy + Kalantosa -->
                <div class="card p-6 pro-con-card">
                    <h3 class="text-xl font-bold text-white mb-4 text-center">Melffy Puppy + Kalantosa</h3>
                    <div class="flex justify-center mb-4">
                        <div id="melffy-puppy-img-container" class="card-image-container card-placeholder">Melffy Puppy</div>
                    </div>
                    <ul class="list-disc list-inside space-y-2 text-green-100">
                        <li><strong class="text-accent font-bold">Disruption on Opponent's Turn:</strong> When the opponent summons, Puppy returns to hand, Special Summoning Kalantosa from the Deck.</li>
                        <li><strong class="text-accent font-bold">Repeatable Destruction:</strong> This interaction triggers Kalantosa's destruction effect, providing powerful, repeatable disruption during the opponent's turn.</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <!-- Pros, Cons, and Tech Cards Section -->
        <section class="mb-10 md:mb-16">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center">Competitive Analysis</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Strengths Card -->
                <div class="card p-6 pro-con-card">
                    <h3 class="text-xl font-bold text-green-400 mb-4">Strengths</h3>
                    <ul class="list-disc list-inside space-y-2 text-green-100">
                        <li><span class="pro-icon"><i class="fas fa-check-circle"></i></span> <strong class="text-green-400 font-bold">Potent Disruption:</strong> Kalantosa's non-once-per-turn effect is incredibly powerful when triggered repeatedly.</li>
                        <li><span class="pro-icon"><i class="fas fa-sitemap"></i></span> <strong class="text-green-400 font-bold">High Synergy:</strong> Seamlessly integrates with top-tier engines like Melffy and Tri-Brigade.</li>
                        <li><span class="pro-icon"><i class="fas fa-cogs"></i></span> <strong class="text-green-400 font-bold">Access to Generic Support:</strong> Leverages powerful Beast support like Rescue Cat and Obedience Schooled.</li>
                    </ul>
                </div>
                <!-- Weaknesses Card -->
                <div class="card p-6 pro-con-card">
                    <h3 class="text-xl font-bold text-red-400 mb-4">Weaknesses</h3>
                    <ul class="list-disc list-inside space-y-2 text-green-100">
                        <li><span class="con-icon"><i class="fas fa-exclamation-triangle"></i></span> <strong class="text-red-400 font-bold">Lack of Cohesive Core:</strong> The archetype is incomplete and cannot function as a standalone deck.</li>
                        <li><span class="con-icon"><i class="fas fa-hand-paper"></i></span> <strong class="text-red-400 font-bold">Vulnerable to Disruption:</strong> Relies heavily on the Normal Summon and Graveyard setup, making it susceptible to hand traps.</li>
                        <li><span class="con-icon"><i class="fas fa-link"></i></span> <strong class="text-red-400 font-bold">Parasitic Nature:</strong> Success is tied to the health of its partner archetypes and generic support cards.</li>
                    </ul>
                </div>
                <!-- External Engines -->
                <div class="card p-6 pro-con-card">
                    <h3 class="text-xl font-bold text-white mb-4">External Engines & Hybrids</h3>
                    <ul class="list-disc list-inside space-y-2 text-green-100">
                        <li><span class="neutral-icon"><i class="fas fa-puzzle-piece"></i></span> <strong class="text-accent font-bold">Melffy Engine:</strong> The most potent pairing, providing repeatable disruption on the opponent's turn.</li>
                        <li><span class="neutral-icon"><i class="fas fa-dna"></i></span> <strong class="text-accent font-bold">Tri-Brigade Engine:</strong> Offers a high-ceiling combo route, with the Mystical Beasts enhancing consistency.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- TCG Banlist Status Section -->
        <section class="mb-10 md:mb-16">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-6 text-center heading-underline">Current TCG Banlist Status</h2>
            <div class="card p-6">
                <p class="text-gray-300 mb-4 text-center">
                    The Mystical Beast of the Forest archetype itself is largely unaffected by the banlist. However, its viability is heavily influenced by the status of its key support cards.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="card combo-step-card p-4">
                        <h4 class="text-lg font-bold text-green-400 mb-2">Unrestricted Cards</h4>
                        <ul id="unrestricted-list" class="list-disc list-inside space-y-1 text-sm text-gray-300">
                            <!-- Content will be populated by JavaScript -->
                        </ul>
                    </div>
                    <div class="card combo-step-card p-4">
                        <h4 class="text-lg font-bold text-yellow-400 mb-2">Limited/Semi-Limited Cards</h4>
                        <ul id="limited-list" class="list-disc list-inside space-y-1 text-sm text-gray-300">
                            <!-- Content will be populated by JavaScript -->
                        </ul>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-blue-900 bg-opacity-30 rounded border-l-4 border-blue-500">
                    <p id="meta-implications" class="text-sm text-gray-300">
                        <!-- Content will be populated by JavaScript -->
                    </p>
                </div>
            </div>
        </section>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- FOREST BANNER ANIMATION ---
            const canvas = document.getElementById('forest-banner');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                let particles = [];

                const setCanvasSize = () => {
                    canvas.width = canvas.offsetWidth;
                    canvas.height = canvas.offsetHeight;
                };

                class Particle {
                    constructor() {
                        this.x = Math.random() * canvas.width;
                        this.y = canvas.height + Math.random() * 100;
                        this.size = Math.random() * 2 + 0.5;
                        this.speedY = Math.random() * 1.5 + 0.5;
                        this.opacity = Math.random() * 0.5 + 0.2;
                    }

                    update() {
                        this.y -= this.speedY;
                        if (this.y < -10) {
                            this.y = canvas.height + 10;
                            this.x = Math.random() * canvas.width;
                        }
                    }

                    draw() {
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(167, 243, 208, ${this.opacity})`;
                        ctx.fill();
                    }
                }

                function init() {
                    particles = [];
                    const particleCount = (canvas.width * canvas.height) / 8000;
                    for (let i = 0; i < particleCount; i++) {
                        particles.push(new Particle());
                    }
                }

                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    particles.forEach(p => {
                        p.update();
                        p.draw();
                    });
                    requestAnimationFrame(animate);
                }

                setCanvasSize();
                init();
                animate();

                window.addEventListener('resize', () => {
                    setCanvasSize();
                    init();
                });
            }

            // --- CARD POPUP SYSTEM ---
            const cardDataCache = {};
            let currentPopupCard = null;
            let isPopupVisible = false;

            async function fetchCardData(cardName) {
                if (cardDataCache[cardName]) {
                    return cardDataCache[cardName];
                }
                try {
                    const response = await fetch(`https://db.ygoprodeck.com/api/v7/cardinfo.php?name=${encodeURIComponent(cardName)}`);
                    if (!response.ok) throw new Error('API error');
                    const data = await response.json();
                    const card = data.data[0];
                    cardDataCache[cardName] = card;
                    return card;
                } catch (error) {
                    console.error(`Failed to fetch data for "${cardName}":`, error);
                    return null;
                }
            }

            
                const popup = document.getElementById('card-popup');
                if (!popup || !cardData) return;

                const imageUrl = cardData.card_images?.[0]?.image_url;
                const name = cardData.name || 'Unknown';
                const type = cardData.type || '';
                const desc = cardData.desc || '';
                const atk = cardData.atk !== undefined ? cardData.atk : '';
                const def = cardData.def !== undefined ? cardData.def : '';
                const level = cardData.level ? `Level ${cardData.level}` : '';
                const race = cardData.race || '';
                const attribute = cardData.attribute || '';

                let stats = '';
                if (level) stats += level + ' ';
                if (race) stats += race + ' ';
                if (attribute) stats += attribute + ' ';
                if (atk !== '') stats += `ATK/${atk} `;
                if (def !== '') stats += `DEF/${def}`;

                popup.innerHTML = `
                    ${imageUrl ? `<img src="${imageUrl}" alt="${name}">` : ''}
                    <h3>${name}</h3>
                    <p class="type">${type}</p>
                    <p class="stats">${stats}</p>
                    <p>${desc}</p>
                `;

                popup.classList.add('show');
                isPopupVisible = true;
                currentPopupCard = cardData;
                movePopup(event);
            }

            
                const popup = document.getElementById('card-popup');
                if (popup) {
                    popup.classList.remove('show');
                    isPopupVisible = false;
                    currentPopupCard = null;
                }
            }

            function movePopup(event) {
                if (!isPopupVisible) return;
                const popup = document.getElementById('card-popup');
                if (!popup) return;

                const mouseX = event.clientX;
                const mouseY = event.clientY;
                const popupWidth = 300;
                const popupHeight = 400;
                const margin = 10;

                let left = mouseX + margin;
                let top = mouseY + margin;

                if (left + popupWidth > window.innerWidth) {
                    left = mouseX - popupWidth - margin;
                }
                if (top + popupHeight > window.innerHeight) {
                    top = mouseY - popupHeight - margin;
                }

                popup.style.left = `${left}px`;
                popup.style.top = `${top}px`;
            }

            document.addEventListener('mousemove', movePopup);
            document.addEventListener('click', (event) => {
                if (!event.target.closest('.card-placeholder')) {
                    hidePopup();
                }
            });

            CardLoader.loadCards({
                'kittytail-img-container': 'Kittytail, Mystical Beast of the Forest',
                'valerifawn-img-container': 'Valerifawn, Mystical Beast of the Forest',
                'kalantosa-img-container-combo': 'Kalantosa, Mystical Beast of the Forest',
                'melffy-forest-img-container': 'Melffy of the Forest',
                'melffy-puppy-img-container': 'Melffy Puppy',
            });

            for (const [containerId, cardName] of Object.entries(cardsToLoad)) {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `<div class="card-placeholder animate-fadeIn">${cardName}</div>`;
                    container.addEventListener('click', async (event) => {
                        event.stopPropagation();
                        if (isPopupVisible && currentPopupCard?.name === cardName) {
                            hidePopup();
                        } else {
                            const cardData = await fetchCardData(cardName);
                            showPopup(cardData, event);
                        }
                    });
                }
            }

            // --- BANLIST LOGIC ---
            async function checkBanlist() {
                const cardNames = [
                    "Carpiponica, Mystical Beast of the Forest",
                    "Kittytail, Mystical Beast of the Forest",
                    "Kalantosa, Mystical Beast of the Forest",
                    "Valerifawn, Mystical Beast of the Forest",
                    "Uniflora, Mystical Beast of the Forest",
                    "Alpacaribou, Mystical Beast of the Forest",
                    "Eco, Mystical Spirit of the Forest",
                    "Rescue Cat", 
                    "Obedience Schooled",
                    "Apollousa, Bow of the Goddess"
                ];

                const unrestrictedList = document.getElementById('unrestricted-list');
                const limitedList = document.getElementById('limited-list');
                const metaImplications = document.getElementById('meta-implications');

                try {
                    const response = await fetch("https://db.ygoprodeck.com/api/v7/cardinfo.php?banlist=tcg");
                    if (!response.ok) throw new Error("Could not fetch banlist data.");
                    
                    const data = await response.json();
                    const banlistData = data.data;

                    let limitedCount = 0;

                    cardNames.forEach(name => {
                        const card = banlistData.find(c => c.name === name);
                        const li = document.createElement('li');
                        li.textContent = name;

                        if (card && card.banlist_info && card.banlist_info.ban_tcg) {
                            const status = card.banlist_info.ban_tcg;
                            if (status === "Limited" || status === "Semi-Limited") {
                                li.innerHTML += ` <strong class="text-yellow-400">(${status})</strong>`;
                                limitedList.appendChild(li);
                                limitedCount++;
                            } else if (status === "Banned") {
                                li.innerHTML += ` <strong class="text-red-400">(${status})</strong>`;
                                limitedList.appendChild(li);
                                limitedCount++;
                            } else {
                                unrestrictedList.appendChild(li);
                            }
                        } else {
                            unrestrictedList.appendChild(li);
                        }
                    });

                    if (limitedList.children.length === 0) {
                        limitedList.innerHTML = '<li>None of the core cards or key support are currently on the TCG banlist.</li>';
                    }
                    
                    if(limitedCount > 0){
                         metaImplications.textContent = "While the core Mystical Beast engine is unrestricted, the deck's power is slightly curtailed by the limitation of key generic support cards like Obedience Schooled. This requires duelists to build with more resilience and less reliance on single-card starters.";
                    } else {
                         metaImplications.textContent = "With no core or key support cards on the banlist, the Mystical Beast of the Forest engine can be played at full potential, allowing for maximum consistency and power in its various hybrid builds.";
                    }


                } catch (error) {
                    console.error("Error checking banlist:", error);
                    unrestrictedList.innerHTML = '<li>Error loading banlist data.</li>';
                    limitedList.innerHTML = '<li>Error loading banlist data.</li>';
                }
            }

            checkBanlist();
        });
    </script>
    <div id="card-popup"></div>
</body>
</html>


